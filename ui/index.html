<!DOCTYPE html>
<html lang="pt-br">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>HERisk</title>
	<link rel="stylesheet" type="text/css" href="css/app.css">
</head>

<body>
<main>
	<div class="btn-group btn-group-lg text-right" id="top-buttons">
		<button title="Minimizar" class="btn btn-primary btn-main" id="minimize_button" onclick="rend.remote.BrowserWindow.getFocusedWindow().minimize()"></button>
		<button title="Fechar" class="btn btn-danger btn-main" id="close_button" onclick="rend.ipcRenderer.send('sair')"></button>
	</div>
	
	<header class="pb-3 fixed-top bg-primary">
		<div class="container bg-light" id="config">
			<p class="m-0 pt-2 user-select-none"><span data-lang="change_lang"></span>:</p>
			<a href="#" onclick="setLang('en-US')">
				<img src="images/enus.png" alt="English USA" title="English USA">
			</a>
			<a href="#" onclick="setLang('pt-BR')">
				<img src="images/ptbr.png" alt="Português Brasil" title="Português Brasil">
			</a>
			<h1 class="m-0 mt-4 user-select-none" id="logo">he<b>risk</b></h1>
		</div>
	</header>

	<section>
		<div class="container">
			<div id="modal">
				<div class="container">
					<div class="alert alert-danger d-none" id="executeDanger" role="alert"></div>
				</div>
			</div>

			<nav class="nav flex-column" id="menu-principal">
				<a class="nav-link p-0 mb-2" href="#" onclick="rend.shell.openPath(rend.remote.app.getAppPath() + '\\bin\\input.xlsm')" title="Abrir planilha para inseir os dados.">
					<span data-lang="input_data"></span>
				</a>
				<a class="nav-link p-0 mb-2" href="#" id="execute-btn" onclick="execute()" title="Executar o HERisk.">
					<span data-lang="execute"></span>
				</a>
				<a class="nav-link p-0 mb-2" href="#" id="results" title="Salvar planilhas dos resultados.">
					<span data-lang="results"></span>
				</a>
			</nav>

			<nav class="nav flex-column" id="menu-bottom">
				<a class="nav-link p-0 m-0" title="How to use">How to use</a>
				<a class="nav-link p-0 m-0" title="See the guide" onclick="rend.ipcRenderer.send('guide')">Guide</a>
				<a class="nav-link p-0 m-0" title="Set preferences" onclick="toggleConfig()">Preferences</a>
				<a class="nav-link p-0 m-0" title="About" onclick="rend.remote.app.showAboutPanel()">About</a>
			</nav>
		</div>
	</section>

	<footer class="fixed-bottom">
		<div class="container">
			<p class="pt-3 user-select-none" onclick="location.reload()">
				&copy; 2020 - <span class="year"></span>. <span data-lang="all_rights"></span>. <span class="app_version"></span>
			</p>
		</div>
		<div class="container" id="config-footer">
			<p class="m-0 pt-3 user-select-none"><span data-lang="version"></span> <span class="version"></span></p>
		</div>
	</footer>
</main>
</body>
<script>
	const rend = require('./renderer.js')
	const $ = arg => document.querySelector(arg)
	const $$ = arg => document.querySelectorAll(arg)
	const setLang = arg => {
		localStorage.setItem('lang', arg)
		location.reload()
	}

	if(localStorage.getItem('lang')) {
		var lang = rend.lang(localStorage.getItem('lang'))
	}
	else {
		localStorage.setItem('lang', Intl.DateTimeFormat().resolvedOptions().locale)
		var lang = rend.lang(localStorage.getItem('lang'))
	}

	d = new Date()
	$('.year').innerHTML = d.getFullYear()
	$('.version').innerHTML = rend.pkg().version

	// PEGA OS ELEMENTOS E INSERE AS DEVIDAS TRADUÇÕES
	$$('span[data-lang]').forEach(spn => spn.innerHTML = lang[spn.dataset.lang])

	// FAZ O BOX DE CONFIGURAÇÃO ALTERNAR
	const toggleConfig = () => {
		if($('header').style.height === '0px') {
			$('header').classList.toggle('slide')
			$('#config-footer').classList.toggle('slide')
		}
		else {
			$('header').classList.toggle('slide')
			$('#config-footer').classList.toggle('slide')
		}
	}

	$('#results').addEventListener('click', () => {
		rend.ipcRenderer.send('gerarOds')
	})

	// FUNÇÃO PARA EXECUTAR O HHRISK
	const execute = () => {
		rend.ipcRenderer.send('clearResults') // APAGA OS JSONS DA PASTA
		rend.ipcRenderer.send('execute')
		rend.ipcRenderer.on('executed', (_, args) => {
			if (args.result == false) {
				$('#executeDanger').innerHTML = args.msg
				$('#executeDanger').classList.toggle('d-none')
				setTimeout(() => {
					$('#executeDanger').classList.toggle('d-none')
				}, 10000)
			}
			console.log(args)
		})
	}
</script>
</html>