<!DOCTYPE html>
<html lang="pt-br">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>HERisk</title>
	<link rel="stylesheet" type="text/css" href="css/app.css">
	<script src="./react.production.min.js" crossorigin></script>
	<script src="./react-dom.production.min.js" crossorigin></script>
	<script src="./react-transition-group.min.js" crossorigin></script>
	<script src="./babel.min.js" crossorigin></script>
</head>

<body>
	<main></main>
</body>

<script>
const rend = require('./renderer.js')
const $ = arg => document.querySelector(arg)
const $$ = arg => document.querySelectorAll(arg)
</script>
<script type="text/babel">
import { Container, Alert, Button, Nav, NavItem, NavLink } from "reactstrap"
// OBJETO COM AS FUNÇÕES DE CLICKS DO LINKS

const clicks = {
	abrirPlanilha: () =>
		rend.shell.openPath(rend.remote.app.getAppPath() + '\\bin\\input.xlsm'),
	showAboutPanel: () =>
		rend.remote.app.showAboutPanel(),
	gerarOds: () =>
		rend.ipcRenderer.send('gerarOds'),
	toggleConfig: () => {
		if ($('header').style.height === '0px') {
			$('header').classList.toggle('slide')
			$('#config-footer').classList.toggle('slide')
		}
		else {
			$('header').classList.toggle('slide')
			$('#config-footer').classList.toggle('slide')
		}
	},
	execute: () => {
		rend.ipcRenderer.send('execute') // EXECUTA O HERISK.EXE
	},
	guide: () =>
		rend.ipcRenderer.send('guide'),
	minimize: () =>
		rend.remote.BrowserWindow.getFocusedWindow().minimize(),
	sair: () =>
		rend.ipcRenderer.send('sair'),
	setLang: arg => {
		localStorage.setItem('lang', arg)// location.reload()
	},
}

// COMPONENTES DO REACT

const Top = () => {
	return (
		<Container>
			<div id="title-bar"></div>
			<div className="btn-group btn-group-lg text-right" id="top-buttons">
				<button title="Minimizar" className="btn btn-primary btn-main"
					id="minimize_button"
					onClick={clicks.minimize}>
				</button>
				<button title="Fechar" className="btn btn-danger btn-main" id="close_button"
					onClick={clicks.sair}></button>
			</div>
		</Container>
	)
}


const Header = () => {
	return (
		<header className="pb-3 fixed-top bg-primary">
			<div className="container-fluid bg-light" id="config">
				<p className="m-0 pt-2 user-select-none">
					<span data-br="Alterar língua">Change language:</span>
				</p>
				<a href="#" onClick={clicks.setLang('default')}>
					<img src="images/enus.png" alt="English USA" title="English USA"/>
				</a>
				<a href="#" onClick={clicks.setLang('br')}>
					<img src="images/ptbr.png" alt="Português Brasil" title="Português Brasil"/>
				</a>
				<h1 className="m-0 mt-4 user-select-none" id="logo">HE<b>Risk</b></h1>
			</div>
		</header>
	)
}

class Section extends React.Component {
	constructor(props) {
		super(props)
		this.state = {
			execute: 'Execute',
			messages: null
		}
	}
	componentWillUnmount = () => {
	}
	componentDidMount = () => {
	}
	execute = () => {
		rend.ipcRenderer.send('execute')
		$('.msgs').classList.toggle('mostrar')
		rend.ipcRenderer.on('resposta', function (_, args) {
			$('.msgs').innerHTML = `<p class="m-0 p-0 pr-3">${args}</p>`
		})
		setTimeout(() => {
			$('.msgs').classList.toggle('mostrar')
		}, 5000)
	}
	gerarOds = () => {
		rend.ipcRenderer.send('gerarOds')
		$('.msgs').classList.toggle('mostrar')
		rend.ipcRenderer.on('resposta', function (_, args) {
			$('.msgs').innerHTML = `<p class="m-0 p-0 pr-3">${args}</p>`
		})
		setTimeout(() => {
			$('.msgs').classList.toggle('mostrar')
		}, 15000)
	}
	render() {
		return (
			<section>
				<Container>
					<Alert color="primary" className="msgs text-center" isOpen={true}>aaa</Alert>
					<Nav vertical id="menu-principal">
						<NavItem>
							<NavLink
								className="nav-link p-0 mb-2"
								onClick={clicks.abrirPlanilha}
								title="Abrir planilha para inseir os dados."
								data-br="Inserir dados"
								data-title-br="">
								Input data
								</NavLink>
						</NavItem>
						<NavItem>
							<NavLink
								className="nav-link p-0 mb-2"
								onClick={this.execute}
								title="Executar o HERisk."
								data-title-br="Executar o HERisk."
								data-br="Executar">
								{this.state.execute}
							</NavLink>
						</NavItem>
						<NavItem>
							<NavLink
								className="nav-link p-0 mb-2"
								title="Salvar planilhas dos resultados."
								onClick={this.gerarOds}
								data-br="Salvar resultados">
								Save results
								</NavLink>
						</NavItem>
					</Nav>
					<hr />
					<Nav id="menu-bottom" vertical>
						<NavItem>
							<NavLink
								className="nav-link p-0 m-0"
								title="How to use"
								data-br="Como usar"
								onClick={() => this.setState({ messages: 'teste' })}>How to use
								</NavLink>
						</NavItem>
						<NavItem>
							<NavLink
								className="nav-link p-0 m-0"
								title="See the guide"
								data-br="Guia"
								onClick={clicks.guide}>Guide
								</NavLink>
						</NavItem>
						<NavItem>
							<NavLink
								className="nav-link p-0 m-0"
								title="Set preferences"
								data-br="Configurações"
								onClick={clicks.toggleConfig}>Preferences
								</NavLink>
						</NavItem>
						<NavItem>
							<NavLink
								className="nav-link p-0 m-0"
								title="About"
								data-br="Sobre"
								onClick={clicks.showAboutPanel}>About
								</NavLink>
						</NavItem>
					</Nav>
				</Container>
			</section>
		)
	}
}

const Footer = props => {
	return (
		<footer className="fixed-bottom">
			<Container>
				<p className="pt-3 user-select-none">
					&copy; 2020 - {new Date().getFullYear()}.
					<span data-br=" Todos os direitos reservados."> All rights reserved.</span>
				</p>
			</Container>
			<Container id="config-footer">
				<p className="m-0 pt-3 user-select-none">
					<span data-br="version">Version </span>
					<span className="version">{rend.remote.app.getVersion()}</span>
				</p>
			</Container>
		</footer>
	)
}

// RENDERIZAR APLICAÇÃO

ReactDOM.render(
	<div>
		<Top />
		<Header />
		<Section />
		<Footer />
	</div>,
	$('main')
)
</script>
</html>