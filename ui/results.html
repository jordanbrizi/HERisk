<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Results</title>
	<link rel="stylesheet" type="text/css" href="./css/app.css">
</head>

<body>
<main>
	<div class="btn-group btn-group-lg text-right" id="top-buttons">
		<button class="btn btn-primary btn-main" id="minimize_button" onclick="rend.remote.BrowserWindow.getFocusedWindow().minimize()"></button>
		<button class="btn btn-danger btn-main" id="close_button" onclick="rend.remote.app.hide()"></button>
	</div>
	<header class="pb-3 page bg-primary">
		<div class="container-fluid pt-3">
			<h1 class="m-0 user-select-none" id="logo">he<b>risk</b>/resultados</h1>
		</div>
	</header>

	<section class="over">
		<div class="container-fluid">
			<div id="loading" class="spinner-border text-light" style="width: 4rem; height: 4rem;" role="status">
				<span class="sr-only">Loading...</span>
			</div>

			<div class="btn-group mr-3">
				<button class="btn btn-secondary btn-lg btn-top active" type="button" data-target="#hhr">Human Health Risk</button>
				<button type="button" class="btn btn-lg btn-secondary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" data-drop="hhr"></button>
				<div class="dropdown-menu bg-none p-0 m-0" style="width: 100%; transform: translateY(-1px);" data-toggle="#hhr">
					<button class="btn btn-success btn-block btn-lg btn-create-sheet pr-5" type="button" data-target="hhr">Salvar Planilhas</button>
				</div>
			</div>

			<div class="btn-group mr-3">
				<button class="btn btn-secondary btn-lg btn-top" type="button" data-target="#er">Ecological Risk</button>
				<button type="button" class="btn btn-lg btn-secondary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" data-drop="er"></button>
				<div class="dropdown-menu bg-none p-0 m-0" style="width: 100%; transform: translateY(-1px);" data-toggle="#er">
					<button class="btn btn-success btn-block btn-lg btn-create-sheet pr-5" type="button" data-target="er">Salvar Planilhas</button>
				</div>
			</div>

			<div class="btn-group mr-3">
				<button class="btn btn-secondary btn-lg btn-top" type="button" data-target="#rr">Radiological Risk</button>
				<button type="button" class="btn btn-lg btn-secondary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" data-drop="rr"></button>
				<div class="dropdown-menu bg-none p-0 m-0" style="width: 100%; transform: translateY(-1px);" data-toggle="#rr">
					<button class="btn btn-success btn-block btn-lg btn-create-sheet pr-5" type="button" data-target="rr">Salvar Planilha</button>
				</div>
			</div>

			<!-- <div class="btn-group">
				<button class="btn btn-warning btn-lg btn-top" type="button" data-target="#rr">Warnings</button>
				<button type="button" class="btn btn-lg btn-warning dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" data-drop="warnings"></button>
				<div class="dropdown-menu bg-none p-0 m-0" style="width: 100%; transform: translateY(-1px);" data-toggle="#warnings">
					<button class="btn btn-primary btn-block btn-lg btn-create-sheet pr-5" type="button" data-target="rr">Exibir</button>
					<button class="btn btn-primary btn-block btn-lg btn-create-sheet pr-5" type="button" data-target="rr">Exibir Texto</button>
				</div>
			</div> -->

			<div class="tab-content">
				<div class="tab-pane pt-3 active" id="hhr"></div>
				<div class="tab-pane pt-3" id="er"></div>
				<div class="tab-pane pt-3" id="rr"></div>
			</div>
		</div>
	</section>

	<footer class="fixed-bottom">
		<div class="container-fluid">
			<p class="pt-3 user-select-none" onclick="//location.reload()">
				&copy; 2020 - <span class="year"></span>. <span data-lang="all_rights"></span>. <span class="app_version"></span>
			</p>
		</div>
	</footer>
</main>
</body>
<script>
	const rend = require('./renderer.js')
	const $ = arg => document.querySelector(arg)
	const $$ = arg => document.querySelectorAll(arg)

	d = new Date()
	$('.year').innerHTML = d.getFullYear()

	if (localStorage.getItem('lang')) {
		var lang = rend.lang(localStorage.getItem('lang'))
	}
	else {
		localStorage.setItem('lang', Intl.DateTimeFormat()
			.resolvedOptions().locale)
		var lang = rend.lang(localStorage.getItem('lang'))
	}

	$$('span[data-lang]').forEach(spn => spn.innerHTML = lang[spn.dataset.lang])

	$('#close_button').addEventListener('click', () => {
		rend.ipcRenderer.send('resultados')
	})

// -----------------------------------------------------------------------------
// -----------------------------------------------------------------------------

const Render = () => {
	const dados = rend.Dados()
	const grupos = Object.keys(dados.arquivos())
	// GRUPODE DOS JSONS
	grupos.forEach(grupo => {
		// ARQUIVOS DOS JSONS
		dados.arquivos()[grupo].forEach(arquivo => {
			chaves = Object.keys(dados.pegar(arquivo))
			// CHAVES DOS JSONS
			// if(arquivo != 'Doses, HQ and CR.json' && arquivo != 'Extensive Aggregate Risk.json') {
			chaves.forEach(chave => {
				titulos = Object.keys(dados.pegar(arquivo)[chave][0])
				
				tabela = document.createElement('table')
				tbody = document.createElement('tbody')
				thead = document.createElement('thead')
				tr = document.createElement('tr')
				h6 = document.createElement('h6')
				
				h6.innerHTML = `${chave}:`
				h6.classList = 'mb-3'
				tabela.classList = 'table table-sm table-hover table-striped table-dark'
				thTitulos = titulos.reduce((acc, t) => {
					acc += `<th class="align-middle text-center">${t.trim()}</th>`
					return acc
				}, '')

				$(`#${grupo}`).appendChild(h6)
				$(`#${grupo}`).appendChild(tabela).appendChild(thead)
					.appendChild(tr)
				tr.innerHTML = thTitulos

				rows = Object.keys(dados.pegar(arquivo)[chave]) //CHAVE DOS REGISTROS
				rows.forEach(key => {
					trRegs = document.createElement('tr')
					regs = Object.values(dados.pegar(arquivo)[chave][key])
						.join('</td><td class="align-middle text-center">') //REGISTROS
					trRegs.innerHTML = `<td class="align-middle text-center">${regs}</td>`
					$(`#${grupo}`).appendChild(tabela).appendChild(tbody)
						.appendChild(trRegs)
				})
			})
			// } // if(arquivo != 'Doses, HQ and CR.json' && arquivo != 'Extensive Aggregate Risk.json') {
		})
	})
	// REMOVE O LOADING
	$('#loading').classList.toggle('invisible')
	// FUNCIONALIDADE DOS NAVS
	$$('.btn-top').forEach(btn => {
		btn.addEventListener('click', function () {
			// REMOVE OS .active DE TODOS	
			$$('.btn-top').forEach(ts => ts.classList.remove('active'))
			$$('.tab-pane').forEach(ts => ts.classList.remove('active'))
			// ADICIONA APENAS AO ATUAL
			this.classList.toggle('active')
			$(`${this.dataset.target}`).classList.toggle('active')
		})
	})
	$$('.dropdown-toggle').forEach(btn => {
		btn.addEventListener('click', function () {
			$(`.dropdown-menu[data-toggle='#${this.dataset.drop}']`).classList.toggle('show')
		})
	})
	$$('.btn-create-sheet').forEach(btn => {
		btn.addEventListener('click', function () {
			rend.ipcRenderer.send('gerarOds', { grupo: this.dataset.target })
		})
	})
}

document.addEventListener('readystatechange', event => {
	if (event.target.readyState === "complete") {
		Render()
	}
})
</script>
</html>